<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
	<link href="/static/css/github.css" rel="stylesheet">

	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</head>

<body style="font-size: 18px">
	<div class="container">
		<div class="col-md-2">
			<div class="row" style="height: 3em">
			</div>
			<div class="row">
				<h1 class="text-left">
					<a href="/speical/time_line.html">TimeLine</a>
				</h1>
			</div>
			<div class="row">
				<h1 class="text-left">
					<a href="/speical/archive.html">Archives</a>
				</h1>
			</div>
			<div class="row">
				<h1 class="text-left">
					<a href="/speical/about.html">About</a>
				</h1>
			</div>
		</div>

		<div class="col-md-10">
			<div class="row" style="height: 3em">
			</div>
			<div class="col-md-9 col-md-offset-2">
				
	<h1 class="text-center" style="word-wrap:break-word">codetest</h1>
	<h1>test</h1>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticlePageGenerator</span><span class="p">(</span><span class="n">BasePlugin</span><span class="p">,</span> <span class="n">_TemplateRender</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1. Generate rel_path of outputs directory. (simple.article + title)</span>
<span class="sd">    2. Deal with url confilcts.</span>
<span class="sd">    3. Register page to article mappings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plugin</span> <span class="o">=</span> <span class="s">&#39;gen_article_page&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_rel_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_adjust_conflict_rel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">rel_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_rel_paths</span><span class="p">:</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;.html$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;remove_conflict.html&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_rel_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel_path</span>

    <span class="k">def</span> <span class="nf">_generate_article_rel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path_to_inputs</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rel_path_to_inputs</span><span class="p">)</span>
        <span class="c"># generate url base on rel_path of inputs.</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">ShareData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;simple.article&#39;</span><span class="p">),</span>
            <span class="n">filename</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c"># change extension to .html.</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="s">&#39;.html&#39;</span>
        <span class="c"># adjust conflits url.</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_conflict_rel_path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel_path</span>

    <span class="k">def</span> <span class="nf">_render_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article_file</span><span class="p">):</span>
        <span class="n">template_render</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_particle_template_render</span><span class="p">(</span><span class="s">&#39;article.html&#39;</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">template_render</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">article_file</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
            <span class="n">article_html</span><span class="o">=</span><span class="n">article_file</span><span class="o">.</span><span class="n">html</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span>
</pre></div>


	<div class="row" style="height: 7em">
	</div>
    

			</div>
		</div>
	</div>
</body>
</html>